<!DOCTYPE html>
<html>
<head>
    <title>pyMetric Dashboard</title>
    <script src="js/jquery.js"></script>
    <script src="js/chart.js"></script>
    <script src="js/index.js"></script>
    <script src="js/knockout.js"></script>
    <script src="js/moment.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <link rel="stylesheet" href="bootstrap/css/bootstrap.css"/>
    <link rel="stylesheet" href="css/style.css"/>
    <script src="bootstrap/js/bootstrap.js"></script>
</head>
<body>
<div class="" id="content">
    <div class="col-md-6" id="content_left">
        <div class="panel panel-default">
            <!-- Messages Panel -->
            <table class="table" id="message_table">
                <thead>
                    <tr>
                        <th width="20%">Zeitpunkt</th>
                        <th width="20%">Herkunft</th>
                        <th width="55%">Nachricht</th>
                        <th width="5%">Typ</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- ko foreach: messages -->
                    <tr data-bind="css: { 'alert-info': Type() == 1, 'alert-warning': Type() == 2, 'alert-danger': Type() == 3 }">
                        <td><div data-bind="text: Time"></div></td>
                        <td><div data-bind="text: Origin"></div></td>
                        <td><div data-bind="text: Message"></div></td>
                        <td><div data-bind="text: Type"></div></td>
                    </tr>
                    <!-- /ko -->
                </tbody>
            </table>
            <script>
                function MessageViewModel() {
                    var self = this;
                    self.messages = ko.observableArray();

                    function updateMessages() {
                        $.getJSON("http://localhost:5000/metric/api/v1.0/message/20", function (data) {
                            self.messages.removeAll();
                            $.each(data, function() {
                                self.messages.push({
                                    Time: ko.observable(moment.unix(this.Time).format("DD.MM.YYYY HH:mm:ss")),
                                    Origin: ko.observable(this.Origin),
                                    Message: ko.observable(this.Message),
                                    Type: ko.observable(this.Type, 10)
                                });
                            });
                            setTimeout(updateMessages, 2000);
                        });
                    }
                    updateMessages();
                }
                ko.applyBindings(new MessageViewModel(), $('#message_table')[0]);
            </script>
        </div>
        <div style="clear: both"></div>
        <div id="lineCharts">
            <div class="panel panel-default">
                <canvas id="lChart1" class="chart"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-6" id="content_right">
        <div class="panel panel-default">
            <div class="row" id="doughnutCharts">
                <div class="col-md-6 dChartBox" id="dChartBox1">
                    <canvas id="dChart1" class="chart"></canvas>
                </div>
                <div class="col-md-6 dChartBox" id="dChartBox2">
                    <canvas id="dChart2" class="chart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
